# Проект: Репликация Видео Афиши

## Цель
Создать зацикленное видео, где афиша разворачивается из бумажного шара в лист и сминается обратно в шар. Затем изображение афиши меняется, и цикл повторяется для нового плаката.
Края афиши складываются во все стороны (естественная физика), но общий тренд сминания — внутрь, формируя плотный шар.

## Требования

### 1. Инструментарий
- **Blender**: Версия 2.82+ (headless mode)
- **FFmpeg**: Для сборки кадров и анализа
- **OpenCV**: Для анализа кадров (сравнение, метрики)

### 2. Анализ и Подготовка
- Провести анализ референсного видео (разрешение, динамика, монтажные склейки).
- Проанализировать предоставленные документы рекомендаций на предмет ссылок (выполнено: ссылок нет).
- Использовать калибровочные оси (X=Red, Y=Green, Z=Blue) для настройки сцены.

### 3. Сцена и Анимация
- **Разрешение**: 864x1104 (на основе референса).
- **Объекты**: Плакаты (planes) с текстурами из `afisha-selected`.
- **Эффекты**:
    - **Алгоритм Генерации (Flat -> Crumpled)**:
        - Генерация идет СТРОГО ОТ ЦЕЛОГО К СМЯТОМУ (от Фрейма 44 к Фрейму 33).
        - **Процесс**: Берем ровный лист (Frame 44) -> Создаем крупные изломы -> Получаем Frame 43 -> Добавляем еще изломы -> ... -> Получаем реалистичный шарик (Frame 33).
        - **Изломы**:
            - Генерируются случайно, но реалистично.
            - Преимущественно крупные.
            - **Микро-уровень**: В районе изломов должна сохраняться "кусочная гладкость" (признаки ткани), чтобы избежать артефактов жесткой полигональной сетки.
    - **Цикл Видео**:
        1. Разворачивание (Play Reverse: Ball -> Flat).
        2. Пауза (Flat).
        3. Сминание (Play Forward: Flat -> Ball).
        4. Смена текстуры.
        5. Повтор.

### 4. Документирование
- Все требования и результаты анализов сохранять в папке `docs/`.
- Поддерживать единый документ требований `docs/requirements.md`.

## Этапы Работ (Log)

### Выполнено
- [x] Установка Blender, FFmpeg, Python-зависимостей.
- [x] Извлечение кадров референса в `data/frames_ref`.
- [x] Анализ референса (разрешение 864x1104, 269 кадров).
- [x] Поиск ссылок в документации (результат: пусто).
- [x] Создание базовой калибровочной сцены (`debug_calibration.py`).
- [x] Тестовый рендер постеров (`render_with_posters.py`).
- [x] Настройка скрипта для анимации разворачивания (`animate_unfolding.py`).

### В процессе
- [x] Отрисовка анимации разворачивания (тестовый прогон).
- [x] Создание скрипта сравнения `compare_frames.py`.
- [x] Генерация сравнительного изображения `data/comparison_check.png` (Ref frame 38 vs Gen frame 6).

### План
1. **Строгая верификация**: Сравнивать отдельные ключевые кадры перед запуском полной анимации.
2. Скорректировать `animate_unfolding.py` для рендера конкретного кадра по запросу (не всей последовательности).
3. Добиться визуального сходства на одиночном кадре (угол сгиба, освещение, позиция).
4. Только после утверждения качества переходить к сборке видео.
